<!DOCTYPE html>
<html lang="en"><head><meta name="viewport" content="width=500"><meta charset="utf-8"><title>Twitch Settings</title>
<script>
let CBs=["ANY","BOT","YOU","MOD","VIP","SUB"];
function dec2bin(dec) {
  return (dec >>> 0).toString(2);
}
function CF(num) {
  let val="000000" + dec2bin(d.getElementsByName("FLG"+num)[0].value);
  console.log("calculating flag",val);

  for (i=0;i<6;i++) {
    let thisval="off";
    if (val.substr(-i-1,1)=="1") { thisval="on"; }
    console.log(CBs[i]+num,d.getElementsByName(CBs[i]+num)[0].value,thisval);
    d.getElementsByName(CBs[i]+num)[0].checked = (val.substr(-1-i,1)=="1");
  }
}
function GEV(num) {
  d=document;
  let output = "<h3>Events</h3><table><input type=\"hidden\" name=\"EVN\" value=\"" + num + "\" />";

  output += "<tr><th></th><th>Message</th><th>Macro</th><th>any</th><th>bot</th><th>you</th><th>mods</th><th>vips</th><th>subs</th><th>Time</th></tr>";
  for (i=0;i<num;i++) {
    output += "<tr><td><input type=\"text\" name=\"FLG" + (i+1) + "\" onchange=\"CF(" + (i+1) + ")\"/><input type=\"checkbox\" name=\"EN" + (i+1) + "\" /></td>";
    output += "<td><input type=\"text\" placeholder=\"Hello!\" size=10 name=\"MSG" + (i+1) + "\"/></td>";
    output += "<td><input type=\"text\" placeholder=\"&PL=" + (i+1) + "\" size=10 name=\"M" + (i+1) + "\"/></td>";
    for (j=0;j<6;j++) {
      output += "<td><input type=\"checkbox\" name=\""+ CBs[j] + (i+1) + "\" /></td>";
    }
    output += "<td><input style=\"text-align: center;\" type=\"text\" placeholder=\"10\" size=1 name=\"TM" + (i+1) + "\"/> s</td></tr>";
  }
  output += "</table>";
  d.getElementById('events').innerHTML = output;
}

function BNList(num) {
  d=document;
  let Nnum = d.getElementById("NL").value;
  let output = "</th><th>#</th><th>Username</th><th>LEDs</th></tr>";
  for (i=0;i<num;i++) {
    output += "<tr><td>" + (i+1) + "</td>";
    output += "<td><input type=\"text\" size=25 maxlength=25 name=\"USR" + (i+1) + "\"/></td>";

    output += "<td><input type=\"text\" size=2 maxvalue=255 name=\"LEDR" + (i+1) + "\"/></td>";
    output += "</tr>";
  }
  d.getElementById('Nlist').innerHTML = output;
}
function LEDR(num) {
//  " + ((i*Nnum)+1) + " - " + ((i+1)*Nnum) + "
  for (i=0;i<num;i++) {
    d.Sf["TM1"].value=10;
  }
}

function S(){GEV(15);BNList(20);GetV();LEDR(20);}function H(){window.open("https://github.com/Aircoookie/WLED/wiki/Twitch");}function B(){window.history.back();}
function GetV(){}
</script>
%CSS%%SCSS%
<style type="text/css">
  table {
    margin: auto;
  }
  td {
    padding: 0px 10px;
  }
  .segment {
    width: auto;
    margin: 10px auto;
    display: inline-block;
    border: 1px solid #666;
  }
</style>
</head>
<body onload="S()">
<form id="form_s" name="Sf" method="post">
<div class="helpB"><button type="button" onclick="H()">?</button></div>
<button type="button" onclick="B()">Back</button><button type="submit">Save</button><hr>
<h2>Let there be POGGERS</h2>


<span class="segment" id="basic">

  <h3>Basic configuration</h3>
  <table>
    <tr>
      <td><label for="CN">Channel name: </label></td>
      <td><input name="CN" id="CN" type="text"></td>
    </tr>
    <tr>
      <td><label for="CY">YOU: </label></td>
      <td><input name="CY" id="CY" type="text"></td>
    </tr>
    <tr>
      <td><label for="CB">BOT name: </label></td>
      <td><input name="CB" id="CB" type="text" placeholder="i. e. Streamelements"></td>
    </tr>
    <tr>
      <td><label for="CU">Login User: </label></td>
      <td><input name="CU" id="CU" type="text"></td>
    </tr>
    <tr>
      <td><label for="CO">OAuth Token: </label></td>
      <td><input name="CO" id="CO" type="password"></td>
    </tr>
    <tr>
      <td><label for="CD">Default preset: </label></td>
      <td><input name="CD" id="CD" type="number" size="1" min=1 max=16></td>
    </tr>
    <tr>
      <td colspan="2">[ <a href="https://twitchapps.com/tmi/" target="_blank">grab a token here</a> ]<br />
      <b>Warning: never show your token on stream or give it to anyone</b><br /></td>
    </tr>

  </table>
</span><br />
<span id="events" class="segment">&nbsp;</span><br />


<span id="activity" class="segment">
  <h3>Chat activity</h3>
  <table>
    <tr>
      <td><label for="AL">low activity: </label></td>
      <td><input name="AL" id="AL" type="range" min="0" max="100"></td>
      <td><span id="ALV">1</span></td>
    </tr>
    <tr>
      <td><label for="AH">high activity: </label></td>
      <td><input name="AH" id="AH" type="range" min="0" max="100"></td>
      <td><span id="ALH">90</span></td>
    </tr>
    <tr><td colspan=3><i>messages per minute</i></td></tr>
  </table>
  <table>
    <tr>
      <th></th>
      <th>low</th>
      <th>high</th>
    </tr>
    <tr>
      <td>Color 1:</td>
      <td><input type="color" name="AL1" /></td>
      <td><input type="color" name="AH1" /></td>
    </tr>
    <tr>
      <td>Color 2:</td>
      <td><input type="color" name="AL2" /></td>
      <td><input type="color" name="AH2" /></td>
    </tr>
    <tr>
      <td>Color 3:</td>
      <td><input type="color" name="AL3" /></td>
      <td><input type="color" name="AH3" /></td>
    </tr>
    <tr>
      <td>Get current:</td>
      <td><input type="button" value="GET" /></td>
      <td><input type="button" value="GET" /></td>
    </tr>
  </table>
</span><br />


<span id="names" class="segment">
  <h3>Username segments</h3>
  this lets you highlight certain segments of<br />
  the LEDs based on per-user activity in chat.
  <table>
    <tr>
      <td><label for="NL">LEDs per user</label></td>
      <td><input name="NL" id="NL" type="number" size=1></td>
    </tr>
    <tr>
      <td><label for="NN">Number of users</label></td>
      <td><input name="NN" id="NN" type="number" size=1></td>
    </tr>
    <tr>
      <td><label for="NT">Fade time (seconds)</label></td>
      <td><input name="NT" id="NT" type="number" size=1></td>
    </tr>
    <tr>
      <td><label for="NC">Highlight color</label></td>
      <td><input name="NC" id="NC" type="color" /></td>
    </tr>
  </table>
  <table id="Nlist">

  </table>
</span>
<hr><button type="button" onclick="B()">Back</button><button type="submit">Save</button>
</form>
</body>
</html>
